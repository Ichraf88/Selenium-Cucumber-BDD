pipeline {
  agent any

  tools {
    jdk   'JDK21'
    maven 'Maven 3.9.12'
  }

  options {
    timestamps()
    disableConcurrentBuilds()
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Build & Test') {
      steps {
        bat 'java -version'
        bat 'mvn -version'
        bat 'mvn -U -e clean test'
      }
    }
  }

  post {
    always {
      // Résultats JUnit (Surefire)
      junit testResults: 'target/surefire-reports/*.xml', allowEmptyResults: true

      // Rapport Cucumber HTML (si généré)
      publishHTML(target: [
        reportDir: 'target/cucumber-report',
        reportFiles: 'cucumber.html',
        reportName: 'Cucumber Report',
        keepAll: true,
        alwaysLinkToLastBuild: true,
        allowMissing: true
      ])

      // Archive (rapports + screenshots/logs si tu en génères)
      archiveArtifacts artifacts: 'target/**, screenshots/**, logs/**', allowEmptyArchive: true
    }
  }
}
